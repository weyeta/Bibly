<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Esc치ner de C칩digos</title>
  <style>
    body {
      font-family: sans-serif;
      font-size: 1.2rem;
      padding: 1rem;
      background: #f9f9f9;
    }
    .scanner-container {
      position: relative;
      width: 100%;
    }
    video {
      width: 100%;
      height: auto;
      background: black;
    }
    .overlay {
      position: absolute;
      top: 25%;
      left: 25%;
      width: 50%;
      height: 50%;
      border: 3px dashed #00cc00;
      pointer-events: none;
      box-sizing: border-box;
    }
    #output {
      font-weight: bold;
      color: green;
      margin-top: 1rem;
    }
    .error {
      color: red;
    }
    canvas {
      display: none;
    }
  </style>
</head>
<body>
  <h2>游닝 Escane치 un c칩digo</h2>

  <label for="cameraSelect">Seleccion치 la c치mara:</label>
  <select id="cameraSelect"></select>

  <div class="scanner-container">
    <video id="preview" autoplay playsinline></video>
    <div class="overlay"></div>
  </div>

  <p><strong>Resultado:</strong> <span id="output">...</span></p>
  <p id="errorMsg" class="error"></p>

  <canvas id="canvas"></canvas>

  <!-- Agregamos la versi칩n UMD (no ES module) -->
  <script src="https://cdn.jsdelivr.net/npm/@zxing/library@latest"></script>

  <script>
    const codeReader = new ZXing.BrowserMultiFormatReader();
    const videoElement = document.getElementById('preview');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const output = document.getElementById('output');
    const cameraSelect = document.getElementById('cameraSelect');
    const errorMsg = document.getElementById('errorMsg');

    let videoStream = null;
    let decodeInterval = null;

    async function listCameras() {
      try {
        const tempStream = await navigator.mediaDevices.getUserMedia({ video: true });
        tempStream.getTracks().forEach(track => track.stop());

        const devices = await navigator.mediaDevices.enumerateDevices();
        const videoDevices = devices.filter(d => d.kind === 'videoinput');

        cameraSelect.innerHTML = '';
        videoDevices.forEach((device, index) => {
          const option = document.createElement('option');
          option.value = device.deviceId;
          option.text = device.label || `C치mara ${index + 1}`;
          cameraSelect.appendChild(option);
        });

        return videoDevices;
      } catch (err) {
        errorMsg.textContent = 'Error al listar c치maras: ' + err.message;
        return [];
      }
    }

    async function startScanner(deviceId) {
      if (videoStream) {
        videoStream.getTracks().forEach(track => track.stop());
      }
      if (decodeInterval) {
        clearInterval(decodeInterval);
      }
