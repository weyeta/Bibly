<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Escanear código</title>
</head>
<body>
  <h2>Escaneá un código de barras 0.05</h2>
  <video id="preview" width="800" height="600" autoplay></video>
  <p><strong>Resultado:</strong> <span id="output"></span></p>

  <script type="module">
    import { BrowserMultiFormatReader } from 'https://cdn.jsdelivr.net/npm/@zxing/browser@0.1.1/+esm';

    const codeReader = new BrowserMultiFormatReader();

    const videoElement = document.getElementById('preview');
    const output = document.getElementById('output');

    const constraints = {
      video: {
        facingMode: 'environment', // cámara trasera
        width: { ideal: 1920 },
        height: { ideal: 1080 },
        focusMode: 'continuous', // algunos navegadores lo aceptan
        advanced: [
          { focusMode: 'continuous' }
        ]
      }
    };

    // Solicitamos directamente el stream con constraints
    navigator.mediaDevices.getUserMedia(constraints).then(stream => {
      videoElement.srcObject = stream;
      codeReader.decodeFromVideoElement(videoElement, (result, err) => {
        if (result) {
          output.textContent = result.getText();
          codeReader.reset();
          stream.getTracks().forEach(track => track.stop()); // apagamos la cámara
        }
      });
    }).catch(err => {
      console.error('Error accediendo a la cámara:', err);
    });
  </script>
</body>
</html>
